package nav

import (
	"github.com/joshuablais/precipice/components/button"
	"github.com/joshuablais/precipice/components/themetoggle"
)

templ Navigation(cfg NavConfig) {
	<header class="nav">
		<div class="nav__inner">
			@Logo(cfg)
			@DesktopNav(cfg)
			<div class="nav__actions">
				@themetoggle.ThemeToggle()
				@DesktopAuthButtons(cfg)
				@HamburgerButton()
			</div>
		</div>
		@MobileMenu(cfg)
	</header>
}

templ Logo(cfg NavConfig) {
	<a href={ templ.SafeURL(cfg.Logo.Href) } class="nav__logo">
		if cfg.Logo.Image != "" {
			<img src={ cfg.Logo.Image } alt={ cfg.Logo.AltText } class="nav__logo-icon"/>
		}
		<span>{ cfg.Logo.AltText }</span>
	</a>
}

templ DesktopNav(cfg NavConfig) {
	<nav class="nav__links">
		for _, item := range cfg.Items {
			<a href={ templ.SafeURL(item.Href) } class="nav__link">
				{ item.Label }
			</a>
		}
	</nav>
}

templ DesktopAuthButtons(cfg NavConfig) {
	<div class="nav__auth">
		for _, authBtn := range cfg.AuthButtons {
			@button.Button(button.Props{
				Variant: button.Variant(authBtn.Variant),
				Size:    button.SizeSm,
				Href:    authBtn.Href,
			}) {
				{ authBtn.Label }
			}
		}
	</div>
}

templ HamburgerButton() {
	@button.Button(button.Props{
		Variant: button.VariantGhost,
		Size:    button.SizeIcon,
		Class:   "nav__hamburger",
		Attrs: templ.Attributes{
			"popovertarget": "mobile-menu",
			"aria-label":    "Toggle navigation menu",
		},
	}) {
		<span class="nav__hamburger-icon" aria-hidden="true">
			<span class="bar"></span>
			<span class="bar"></span>
			<span class="bar"></span>
		</span>
	}
}

templ MobileMenu(cfg NavConfig) {
	<div
		id="mobile-menu"
		class="mobile-menu"
		popover
		role="dialog"
		aria-modal="true"
		aria-label="Navigation menu"
	>
		<div class="mobile-menu__header">
			<a href={ templ.SafeURL(cfg.Logo.Href) } class="nav__logo">
				<svg class="nav__logo-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
					<path d="m8 3 4 8 5-5 5 15H2L8 3z"></path>
				</svg>
				<span>{ cfg.Logo.AltText }</span>
			</a>
			@button.Button(button.Props{
				Variant: button.VariantGhost,
				Size:    button.SizeIcon,
				Attrs: templ.Attributes{
					"popovertarget":       "mobile-menu",
					"popovertargetaction": "hide",
					"aria-label":          "Close menu",
				},
			}) {
				<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
					<path d="M18 6 6 18"></path>
					<path d="m6 6 12 12"></path>
				</svg>
			}
		</div>
		<nav class="mobile-menu__nav">
			for _, item := range cfg.Items {
				<a href={ templ.SafeURL(item.Href) } class="mobile-menu__link">
					{ item.Label }
				</a>
			}
		</nav>
		<div class="mobile-menu__section">
			<p class="mobile-menu__section-title">Appearance</p>
			@themetoggle.ThemeToggle()
		</div>
		<div class="mobile-menu__section">
			<div class="mobile-menu__auth">
				for _, authBtn := range cfg.AuthButtons {
					@button.Button(button.Props{
						Variant: button.Variant(authBtn.Variant),
						Size:    button.SizeMd,
						Href:    authBtn.Href,
						Class:   "w-full",
					}) {
						{ authBtn.Label }
					}
				}
			</div>
		</div>
	</div>
}
